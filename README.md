# TDD λ΅ κ°λ°ν•κΈ°

## π“λ©μ°¨

1. [μ”κµ¬μ‚¬ν•­](#1.-μ”κµ¬μ‚¬ν•­)
2. [λ™μ‹μ„± μ μ–΄ λ°©μ‹μ— λ€ν• λ¶„μ„ λ° λ³΄κ³ μ„](#2.-λ™μ‹μ„±-μ μ–΄-λ°©μ‹μ—-λ€ν•-λ¶„μ„-λ°-λ³΄κ³ μ„)

<br />

## 1. μ”κµ¬μ‚¬ν•­
#### β“ `point` ν¨ν‚¤μ§€μ TODO μ™€ ν…μ¤νΈμ½”λ“λ¥Ό μ‘μ„±ν•΄μ£Όμ„Έμ”.

* PATCH  `/point/{id}/charge` : ν¬μΈνΈλ¥Ό μ¶©μ „ν•λ‹¤.
* PATCH `/point/{id}/use` : ν¬μΈνΈλ¥Ό μ‚¬μ©ν•λ‹¤.
* GET `/point/{id}` : ν¬μΈνΈλ¥Ό μ΅°νν•λ‹¤.
* GET `/point/{id}/histories` : ν¬μΈνΈ λ‚΄μ—­μ„ μ΅°νν•λ‹¤.
* μ”κ³ κ°€ λ¶€μ΅±ν•  κ²½μ°, ν¬μΈνΈ μ‚¬μ©μ€ μ‹¤ν¨ν•μ—¬μ•Ό ν•©λ‹λ‹¤.
* λ™μ‹μ— μ—¬λ¬ κ±΄μ ν¬μΈνΈ μ¶©μ „, μ‚¬μ© μ”μ²­μ΄ λ“¤μ–΄μ¬ κ²½μ° μμ°¨μ μΌλ΅ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.

<br />

## 2. λ™μ‹μ„± μ μ–΄ λ°©μ‹μ— λ€ν• λ¶„μ„ λ° λ³΄κ³ μ„

- λ™μ‹μ„± μ μ–΄ λ©ν‘
  - λ™μ‹μ— μ—¬λ¬ κ±΄μ μ¶©μ „/μ‚¬μ© μ”μ²­μ΄ λ“¤μ–΄μ¤λ”λΌλ„ ν•λ²μ— ν•λ‚μ μ”μ²­μ”©λ§ μ μ–΄λ  μ μλ„λ΅ ν•΄μ•Όν•¨.
  

- `ReentrantLock`μ„ ν†µν• λ™μ‹μ„± μ μ–΄
  - ν¬μΈνΈ μ¶©μ „/μ‚¬μ©μ—λ” κ³µμ •μ„±μ„ λ³΄μ¥ν•  μ μλ” `ReentrantLock`μ΄ μ ν•©ν•λ‹¤κ³  νλ‹¨ν•μ—¬ μ„ νƒν–μµλ‹λ‹¤.
  - `ReentrantLock` μ„ μ‚¬μ©ν•μ—¬ μ—¬λ¬ μ¤λ λ“κ°€ λ™μ‹μ— ν¬μΈνΈ μ¶©μ „/μ‚¬μ©ν•λ” λ¬Έμ λ¥Ό λ°©μ§€ν–μµλ‹λ‹¤.
  - `finally` λΈ”λ΅μ„ μ‚¬μ©ν•μ—¬ λ½μ ν•΄μ λ¥Ό λ³΄μ¥ν•¨μΌλ΅μ¨, λ°λ“λ½μ μ„ν— μ—†μ΄ μ•μ „ν•κ² μ²λ¦¬ν•λ„λ΅ κµ¬ν„ν•μ€μµλ‹λ‹¤.
  - ```java
    @Override
    public UserPoint chargePoint(long id, long amount){
        lock.lock(); // λ½ νλ“
        try{
            ...
        }finally {
            lock.unlock(); // λ½ ν•΄μ 
        }
    }
    ```

- `CompletableFuture`λ¥Ό ν†µν• λ™μ‹μ„± ν…μ¤νΈ
  - `CompletableFuture`λ΅ ν¬μΈνΈ μ¶©μ „/μ‚¬μ© μ”μ²­μ λΉ„λ™κΈ°μ  μƒν™©μ„ ν…μ¤νΈν•μ€κ³ , μ •μƒ μ‘λ™κ³Ό μμ™Έ μ²λ¦¬λ¥Ό κ²€μ¦ν–μµλ‹λ‹¤.
  - ```java
    @Test
    void useChargeConcurrencyTest() {
        ...
    
        CompletableFuture.allOf(
                CompletableFuture.runAsync(() -> {
                    pointService.usePoint(userPoint.id(), 3000L);
                }),
                CompletableFuture.runAsync(() -> {
                    pointService.chargePoint(userPoint.id(), 2000L);
                }),
                CompletableFuture.runAsync(() -> {
                    pointService.usePoint(userPoint.id(), 1000L);
                })
        ).join();
    
        ...
    }
    ```
